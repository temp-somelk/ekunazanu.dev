+++
title = "Quantifying Colour"
description = "A few things about colours and colour formats."
date = 2024-11-13
draft = true
template = "article.html"
[extra]
type = "article"
thumbnail = "lab.colours.svg"
thumbnailalt = "Red, green and blue lines representing a computer screen."
+++

There's a lot of different ways to describe colours. But to pinpoint an exact colour, there needs to be a standard way to represent it. Even some surface level research about the topic reveals that there's extensive science and math behind this seemingly simple task.

Before quantifying colours, it is important to first define what colours even are. [Wikipedia](https://en.wikipedia.org/wiki/Color) defines it as "The visual perception based on the electromagnetic spectrum". So a colour depends on the perception of the viewer, as well as the electromagnetic spectrum — or in plain language, light.

## Spectral Power Distribution

Light is made up of [photons](https://en.wikipedia.org/wiki/Photon). These can thought of as abstract particles carrying specific amounts of energy — determined by their [wavelength or freuqency](https://en.wikipedia.org/wiki/Photon_energy#Physics).

{{ loadData(path="/static/media/lab/quantifying-colour/photon.txt") }}

{% tangent(summary="Photon wave-particle duality", open=false) %}
The above is an interpretation of a photon, and is not necessarily accurate. The exact shape of photons is difficult to describe since photons exhibit [both particle and wave-like behaviour](https://en.wikipedia.org/wiki/Wave%E2%80%93particle_duality#Wave-particle_duality_of_light). Trying to visualize photons as both as a particle and a wave can get very tricky very quickly.
{% end %}

The different wavelengths of photons together form the [electromagnetic spectrum](https://en.wikipedia.org/wiki/Electromagnetic_spectrum). It is simply the full range photons of different energies, ordered by wavelength.

{{ loadData(path="/static/media/lab/quantifying-colour/photon-electromagnetic-spectrum.txt") }}

Since photons carry energy, any body that radiate photons also radiate energy. The rate of energy transferred via photons can be measured as [power](https://en.wikipedia.org/wiki/Power_(physics)).

{{ loadData(path="/static/media/lab/quantifying-colour/photon-power.txt") }}

If the power per unit area, or the [intensity](https://en.wikipedia.org/wiki/Intensity_(physics)) is plotted per wavelength for a body radiating photons of different wavelengths, then the resulting curve yields its [spectral power distribution](https://en.wikipedia.org/wiki/Spectral_power_distribution).

{{ loadData(path="/static/media/lab/quantifying-colour/spd.txt") }}

The spectral power distribution is fundamenetal to determining the 'colour' of an object.

## Photoreceptor Cells

The sun too radiates a large amount of photons, and the spectral power distribution of the sun appears similar to this:

{{ loadData(path="/static/media/lab/quantifying-colour/spd-sunlight.txt") }}

The intensity peaks near 500nm. Human eyes naturally evolved to become sensitive to photons with these wavelengths —  different kinds of [photoreceptor cells](https://en.wikipedia.org/wiki/Photoreceptor_cell) have evolved to become sensitive to photons of wavelengths from 400nm to around 700nm. Depending on the energy carried by the photons (their wavelength and intensity), they can 'excite' the photoreceptor cells to produce a specific response.

The human eye has two kinds of photoreceptor cells — [rod cells](https://en.wikipedia.org/wiki/Rod_cell) and three types of [cone cells](https://en.wikipedia.org/wiki/Cone_cell). The different types of photoreceptor cells are sensitive to different wavelengths of light by differing amounts — some cone cells (S-cones) will not produce a significant response to lights with longer wavelengths but other types (L-cones) will. The [sensitivity](https://en.wikipedia.org/wiki/Spectral_sensitivity) curves of the different photoreceptor cells are shown below:

{{ loadData(path="/static/media/lab/quantifying-colour/sensitivity-curves.txt") }}

{% tangent(summary="Normalized curves", open=true) %}
The sensitivity of S-cones is significantly lower compared to the other cones. Similarly, rods are relatively more sensitive to light than cones. However, the sensitivity curves are normalized, such that the curves have equal areas under the curves — to make subsequent calculations simpler.
{% end %}

The response of the photoreceptor cells to lights of different wavelengths is dependent on the spectral power distribution of the incident light, and the sensitivty of the rods and cones. The responses generated by the different types of photoreceptor cells for [monochromatic light](https://en.wikipedia.org/wiki/Monochromatic_radiation) (light with near singular wavelength) is shown below:

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves.txt") }}

{% tangent(summary="Photoreceptor cell responses", open=true) %}
The response curve of the types of photoreceptor cells is the [point-wise product](https://en.wikipedia.org/wiki/Pointwise#Examples) of the spectral power distribution curve and the photoreceptor sensitivity curves. The overall response from each type of photoreceptor cell is the total area under their corresponding response curves.
{% end %}

Light with differing intensity and wavelengths produce different and unique responses in the three types of cones. The [different responses are perceived by the brain](https://en.wikipedia.org/wiki/Color_vision#Theories) as a colour.

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves-colour-box.txt") }}

{% tangent(summary="Colour Classifications", open=true) %}
There can be more or fewer colour names for these wavelengths depending on the [classification](https://en.wikipedia.org/wiki/Spectral_color#Spectral_color_terms).
{% end %}

Rods do not have a big effect on colour perception. In [well-lit conditions](https://en.wikipedia.org/wiki/Photopic_vision), the cones might produce different responses based on the wavelength of light. But in such conditions, the rod cells produce a saturated response since rods are more sensitive to light than cones. As the response of rods in bright environments is indifferent to wavelengths, it cannot differentiate between distinct wavelengths, and threfore does not have a major impact on colour perception — in bright conditions.

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves-rods-saturation.txt") }}

{% tangent(summary="Saturated response", open=true) %}
The response from rods remain saturated, and no meaningful information about the wavelength is obtained from the response. Cones on the other hand, respond differently to different wavelengths, and the different responses can be interpreted by the brain as different wavelengths.
{% end %}

In [darker environments](https://en.wikipedia.org/wiki/Scotopic_vision), rods produce a response when cones may not. But since there is only one type of rod cells, all rods have almost identical sensitivity curves. So, it is not possible to distinguish between different wavelengths and intensities of light — two light sources with different wavelengths and intensities can produce the same response in rods. There is no way to differentiate between different wavelengths and intensity of light and the brain evolved to perceive the response of the rods as a singular luminance value. So 'colours' appear different shades of grey in the dark.

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves-rods-ambiguity.txt") }}

{% tangent(summary="Wavelength ambiguity", open=true) %}
Two light sources with [different wavelengths](switch#) produce a similar response in rods, and are thus perceived as similar by the brain. This is only if their intensities are not enough to adequately excite the cone cells.
{% end %}

Since rods cannot differentiate between different wavelengths of light, they do not play a role in colour perception — regardless of whether it is dark or bright.

### Colour Blindness

Sometimes cone cells too may not be able to differentiate between different wavelengths of light. This can happen due to missing cones, or cones with overlapping sensitivity curves. Without the third cone, differentiating between certain wavlengths of light is not possible — which manifests as [colour blindess](https://en.wikipedia.org/wiki/Color_blindness).

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves-cones-ambiguity.txt") }}

{% tangent(summary="Wavelength ambiguity", open=true) %}
Wavelengths [XXXnm and YYYnm](switch#) produce a similar responses in cones, and are perceived as similar colours.
{% end %}

The type of cone anomaly determines the type of colour blindness. The L-cones can shift their response curves slightly towards shorter wavelengths ([protanomaly](switch#)), or the M-cones shift their response curves towards longer wavelengths ([deuteranomaly](switch#)). People may also lack functional L-cones ([protanopia](switch#)) or M-cones ([deuteranopia](switch#)) entirely. The result is similar in all the cases — reds and greens look similar, to almost identical. In very rare cases, people may have anomalous S-cones, resulting in [tritanomaly](switch#) and [tritanopia](switch#). In even rarer cases, people may [only have S-cones](switch#), or [no cone cells at all](switch#) — resulting in [total colour blindess](https://en.wikipedia.org/wiki/Monochromacy#Humans).

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves-colour-blindness.txt") }}

### Non-Spectral Colours

All the examples in the above subsections were about [spectral colours](https://en.wikipedia.org/wiki/Spectral_color) — light with very narrow bands of wavelengths. But not all colours are spectral colours. Greys and purples are non-spectral colours that cannot be created using only monochromatic light.

The spectral power distribution of non-spectral colours is not a single spike at a specfic wavelength, unlike spectral colours:

{{ loadData(path="/static/media/lab/quantifying-colour/spd-non-spectral.txt") }}

The set of responses from the cones for non-spectral colours like magenta or grey is different from the set of responses produced by the cones for spectral colours. The brain perceives these unique set of responses from the cones as a separate colour.

Try finding a spectral colour that has an identical response as magenta. It is impossible:

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves-magenta.txt") }}

[Greys](switch#) and [pinks](switch#) too, are composed of light with multiple wavelengths. In both cases, the response of the cones is again unique and different — from the responses generated by monochromatic light.

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves-non-spectral.txt") }}

### Metamerism

In the above cases, various wavelengths of light together created unique responses in cones, which is different from the responses when cones are exposed to monochromatic light. However, multiple wavelengths of light together can also produce a response that is not unique, but very similar to the response of a spectral colour.

Empirical data from colour matching experiments by [William David Wright](https://doi.org/10.1088/1475-4878/30/4/301) and [John Guild](https://doi.org/10.1098/rsta.1932.0005) mapped light consisting of three wavelengths (435nm, 546nm, and 700nm) to spectral colours — by varying the intensities of its constituent monochromatic lights such that the resultant light was perceived to be the same as a spectral colour. The findings were then summarised, and the observations resulted in the colour-matching curves.

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves-cie-rgb-cmf.txt") }}

{% tangent(summary="Negative intensity", open=true) %}
Adding colours to one side is equivalent to sutracting colours from the other side, inferring from [Grassman's laws](https://en.wikipedia.org/wiki/Grassmann%27s_laws_(color_science)). In the colour matching experiment, adding light to the spectral colour being compared is represented as subtracting from the colour matching function curves — resulting in negative intensity.

Physically, it is impossible to create light with negative intensity, so it is impossible to reproduce certain colours using only three wavelengths of light. However, colours can still be represented *theoretically* using negative values.
{% end %}

The three wavelengths of light together produce identical responses to spectral colours in the cones — making them appear similar. So certain spectral colours can be recreated using only three monochromatic sources of light. But there is also a subset of spectral colours which cannot be replicated using only the three wavelengths of light. 

While the experiment had used three spectral colours to replicate most spectral colours, the same three wavelengths can also be used to replicate non-spectral colours. Light with other wavelengths or different spectral power distibutions can be used to reproduce other spectral and non-spectral colours as well. In general, bodies with [different spectral power distributions](switch#below) can be perceived as same colours as long as they generate identical responses in cones. This phenomenon is called [metamerism](https://en.wikipedia.org/wiki/Metamerism_(colour)).

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves-metamerism-cmf.txt") }}

## Colour Space

Since the responses generated by the L-cones, M-cones, and S-cones correspond to a colour, a set of (L,M,S) values can identify a colour. The set of (L,M,S) values can also be mapped as points in a three dimensional space — a colour can be described as a point on this space. As this space can describe colours, it is aptly called a [colour space](https://en.wikipedia.org/wiki/Color_space).

{% tangent(summary="Measuring LMS values" open=false) %}
The (L,M,S) values is the total response of their respective cones. The total response of each cone is simply the area under their corresponding response curves, and the response curves of the cones are the pointwise product of their normalized sensitivity curves and the spectral power distribution. So, if `J(λ)` is the spectral power distrubtion of the light source, and `l(λ)`, `m(λ)`, and `s(λ)` are the sensitivity curves of the L-cones, M-cones, and S-cones — then the L, M, and S values is given by:\
`L = ∫ J(λ)·l(λ) dλ`\
`M = ∫ J(λ)·m(λ) dλ`\
`S = ∫ J(λ)·s(λ) dλ`
{% end %}

In this case, the colour space is the [LMS colur space](https://en.wikipedia.org/wiki/LMS_color_space) — where a colour can be described as a set of (L,M,S) values in this space.

{{ loadData(path="/static/media/lab/quantifying-colour/lms-space.txt") }}

{% tangent(summary="Impossible colours", open=true) %}
While all colours can be represented using LMS values, the reverse is not always true. Not all LMS values correspond to perceivable colours. The sensitivity curves of the M-cones overlaps the sensitivity curves of L-cones and S-cones. Any type of light that excites the M-cones, must also excite the L-cones, or S-cones, or both. So 'colours' having LMS values such as (0,1,0) are [imaginary](https://en.wikipedia.org/wiki/Impossible_color#Imaginary_colors) and physically impossible.
{% end %}

The LMS colour space is one way to describe colours. But there are other ways as well. While fundamental, the LMS colour space is not the standard reference for describing colours — it is the [CIE 1931 colour spaces](https://en.wikipedia.org/wiki/CIE_1931_color_space).

### CIE 1931

In the Wright-Guild colour matching experiments, three wavelengths of light were used to recreate spectral colours by varying the intensity of the individual constituent lights. The same three wavelengths can also be used to produce non-spectral colours.

All these spectral and non-spectral colours can again be represented as a set of three intensity values — for each of the three wavelengths. The set of intensity values can again be represented as points in some space. Colours can be described as points in this space as well, and this colour space is called the [CIE RGB colour space](https://en.wikipedia.org/wiki/CIE_1931_color_space#CIE_RGB_color_space).

{{ loadData(path="/static/media/lab/quantifying-colour/rgb-space.txt") }}

{% tangent(summary="CIE RGB space bases", open=true) %}
The CIE RGB colour space uses as lights of 700nm (R), 546nm (G), and 435nm (B) as its [primaries](https://en.wikipedia.org/wiki/Primary_color#Real_primaries) (colours used to recreate other colours). The LMS colour space, in contrast, used the response of the cones (L,M,S) as its bases.
{% end %}

Mapping spectral colours in the CIE RGB colour space results in the [spectral locus](https://en.wikipedia.org/wiki/Spectral_color#In_color_spaces). This curve represents the intensity of RGB primaries required to replicate spectral colours — it is simply the Wright-Guild colour-matching curves mapped in the CIE RGB colour space.

{{ loadData(path="/static/media/lab/quantifying-colour/rgb-space-spectral-locus.txt") }}

Because of the way the colour space is constructed, parts of the spectral locus have negative RGB values. This means that certain spectral (and non-spectral) colours have to be described using negative values in the CIE RGB colour space.

It was decided that a colour space that could map all colours to non-negative values would have been preferable. But instead of conducting more experiments to construct a new colour space, the existing CIE RGB colour space could also be transformed using simple linear transformations. The transformation of the three dimensional colour space can then be defined by a 3x3 matrix:

{{ loadData(path="/static/media/lab/quantifying-colour/colour-space-transform-matrix.txt") }}

{% tangent(summary="Colour space transformations", open=true) %}
Linear transformation of colour spaces is possible since human colour perception is nearly linear. The linearity of colour perception in humans is again inferred from Grassman's laws.
{% end %}

[Transforming](switch#transformToXYZ) the space means the new space is now defined by different new bases or new primaries. Earlier, some spectral colours had to be defined by negative values of a primary, but now the same colour is defined by positive values. It suggests that the coordinate system (the primaries) itself has to contain some sort of a negative intensity. But it is impossible for light to have negative intensity, implying that the primaries for the new colour cannot physically exist, and are imaginary.

Since the primaries of the new colour space are imaginary, it is reasonable to define the new primaries to represent more abstract concepts instead of physical quantities. Again, it was decided that one of the primaries would define the [luminance](https://en.wikipedia.org/wiki/Luminance) of the colour, and the other two can be used to derive its [chromaticity](https://en.wikipedia.org/wiki/Chromaticity). The primaries of this new colours space are named X, Y, and Z — and the resulting colour space is called [CIE XYZ colour space](https://en.wikipedia.org/wiki/CIE_1931_color_space#Meaning_of_X,_Y_and_Z). The Y primary represents the luminance of a colour, while the X and Z primaries are used to derive its chromaticity.

{% tangent(summary="Luminance and chromaticity", open=false) %}
Luminance refers to the perceived brightness of a colour, while chromaticity is analogous to hues. According to the [opponent process](https://en.wikipedia.org/wiki/Opponent_process) theory, colours are perceieved as pairs of opposing colours — red vs green, blue vs yellow (chromaticity), and black vs white (luminance). Hence, it is possible to describe a colour by how red it is compared to how green it is, how blue it is compared to how yellow it is, and how bright the overall colour is — ie. defining colours based on luminance and chromaticity values.
{% end %}

Similar to how the sensitivity of different cones can be measured, the average sensitivity of all the cones can also be measured — resulting in a curve that effectively functions as a [luminosity sensitivity curve](https://en.wikipedia.org/wiki/Luminous_efficiency_function):

{{ loadData(path="/static/media/lab/quantifying-colour/photopic-curve.txt") }}

This curve can also be approximated as a weighted sum of the individual RGB colour matching function curves:

{{ loadData(path="/static/media/lab/quantifying-colour/photopic-linear-combination-rgb.txt") }}

The [factors](switch#above) represent how much the RGB primaries contribute to the overall brightness or luminance of a colour. But the luminance of a colour is the Y primary in the XYZ colour space. So the factors represent how much each of the RGB primaries contribute to the Y primary in the XYZ colour space — and forms one row of the transformation matrix:

{{ loadData(path="/static/media/lab/quantifying-colour/colour-space-transform-matrix-photopic-fixed.txt") }}

The X and Z primaries was defined such that the new colour space fulfilled [other certain properties](https://en.wikipedia.org/wiki/CIE_1931_color_space#Construction_of_the_CIE_XYZ_color_space_from_the_Wright%E2%80%93Guild_data) decided by the CIE — resulting in a transformation matrix with values:

{{ loadData(path="/static/media/lab/quantifying-colour/colour-space-transform-matrix-all-fixed.txt") }}

The X and Z primaries do not directly represent the chromaticity of a colour, but can be used to derive it. To understand how the X and Z primaries can be used to derive the chromaticity in the CIE XYZ colour space, it first helps to understand how the same can be achieved in the CIE RBG colour space.

### Chromaticity

In the CIE RGB colour space, the sum of the intensity of its primaries (R+G+B) can act as a crude approximation for luminance of a colour, while the ratios between the intensities of the RGB primaries can serve as an approximation for a colour's chromaticity. The ratios r, g, b representing the chromaticity of the R, G, B primaries respectively can then be calculated by normalizing out the total intensity of the primaries:

`r = R/(R+G+B)`\
`g = G/(R+G+B)`\
`b = B/(R+G+B)`

{% tangent(summary="Luminance-chromaticity estimates", open=false) %}
While the luminance and chromaticity are approximations, it does not mean that there is loss of information. The exact RGB values can be recreated using the luminance and chromaticity estimates. The approximation simply refers to the imperfect separation of luminance and chromaticity.
{% end %}

In the CIE RGB colour space, all the colours with a luminosity value of one will lie on the plane R+G+B = 1. The plane is a triangle bounded by the points (1,0,0), (0,1,0), and (0,0,1).

{{ loadData(path="/static/media/lab/quantifying-colour/rgb-space-fixed-luminance-slice.txt") }}

The chromaticity values (r,g,b) of the colours on this plane are simply the (R,G,B) values, since the luminosity is one — the ratios are already normalized.

{{ loadData(path="/static/media/lab/quantifying-colour/rgb-space-fixed-luminance.txt") }}

A colour having some other luminance k would lie on the plane R+G+B = k — the plane in the CIE RGB colour space bounded by (k,0,0), (0,k,0,), and (0,0,k). The chromaticity values (r,g,b) are derived by normalizing the (R,G,B) values. Geometrically, it is the same as scaling the plane, or projecting the point on the R+G+B = 1 plane.

{{ loadData(path="/static/media/lab/quantifying-colour/rgb-space-variable-luminance.txt") }}

{% tangent(summary="Dimensionality reduction", open=false) %}
The line connecting a point (R,G,B) to the origin (0,0,0) can be thought of as lines of chromaticity. Points on the same line but at different distances represent colours with the same chromaticity but different luminance values. The (r,g,b) values are the projection of the points on the R+G+B =1 plane — so colours having the same chromaticity but different luminance values get projected on the same point, leading to [loss of information](https://en.wikipedia.org/wiki/Dimensionality_reduction).

The chromaticity plane contains information about chromaticity, and generally does not contain any information about luminance. So unless luminance is explicitly specified, it is impossible to recreate the corresponding RGB values using just the (r,g,b) values.
{% end %}

Since (r,g,b) values denote ratios, r+g+b is always equal to one. It makes one of the three values redundant. Knowing two, the third can be deduced by subtracting the other two values from one. The values for r and g are kept, and b is discarded. Geometrically, it can be represented by projecting points on the R+G+B = 1 plane to the RG plane.

{{ loadData(path="/static/media/lab/quantifying-colour/rg-plane.txt") }}

{% tangent(summary="The rg plane", open=true) %}
While the points are projected on the RG plane, it is represented as the rg plane because RG and rg represent different quantities. The values (r,g) represent the chromaticity of a colour, while (R,G) values represent the intensity of R and G primaries.
{% end %}

These projections result in a chromaticity plane that describes the chromaticity of a colour using (r,g) values. However, the [rg chromaticity space](https://en.wikipedia.org/wiki/Rg_chromaticity) cannot describe all possible chromaticity of colours with positive values since the CIE RGB colour space itself cannot. But the same idea can be translated for the CIE XYZ colour space.

Similar to how colours were projected on the rg plane in the CIE RGB colour space, the same can be projected on the xy plane in the CIE XYZ colour space. However in this colour space, the bases are imaginary and the only colours that have been mapped so far are the spectral colours. So the chromaticity of spectral colours are first mapped on the xy plane.

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-spectral-locus.txt") }}

{% tangent(summary="Meaning of xy", open=true) %}
The nomenclature used in the CIE XYZ colour space to describe the chromaticity of colours is analagous to the naming convention used in the CIE RGB colour space. So `x = X/(X+Y+Z)` and `y = Y/(X+Y+Z)`.
{% end %}

If two points can define a line in the xy plane, a point on that line can be represented as the ratio of these two points:

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-spectral-locus-line.txt") }}

But the line can also [intersect the spectral locus](switch#below). Then, the point can also be represented as the ratio of the points on the spectral locus:

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-spectral-locus-line-ratios.txt") }}

But the points on spectral locus represent the chromaticity of spectral colours — colours which can be physically perceived. A point in the xy plane can be defined as (x,y) values or as the ratio between the intensity of two (or more) spectral colours.

{% tangent(summary="Colour perception linearity", open=false) %}
The ratio between the intensity of the primaries, ie. (x,y) values, is equal to the ratio between the intensity of the spectal colours because colour perception is linear. The near linearity of human colour perception is again inferred from Grassman's laws.
{% end %}

All the points inside the spectral locus are all non-spectral colours and their chromaticity can be represented as the ratio between the intensity of other spectral colours. If all these colours, along with all the spectral colours are mapped in the xy plane, it results in the [CIE xy chromaticity diagram](https://en.wikipedia.org/wiki/CIE_1931_color_space#/media/File:CIE1931xy_blank.svg):

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie.txt") }}

The chromaticity (and colours) outside the spectral locus are imaginary, but all the points inside contain the chromaticity of all colours perceviable by an average human. As the CIE xy chromaticity diagram can represent all perceivable chromaticities, it is often used for comparing other colour spaces.

{% tangent(summary="The xy plane to compare colour spaces", open=false) %}
The xy chromaticity diagram represents a *chromaticity* space, not a *colour* space. Using a chromaticity space to compare colour spaces is not perfectly accurate, since luminance information cannot be compared. However comparing chromaticity information is simpler, and sufficient in certain cases. For a more complete comparison of colour spaces, the CIE XYZ colour space is generally used as the standard reference instead.
{% end %}

{% tangent(summary="CIE xyY colour space", open=false) %}
The CIE xy chromaticity diagram represents chromaticity, but not colours since there is no information about luminance. Adding a luminance component allows it to represent colours, forming a colours space. In the RGB colour space the luminance of a colour was approximated as the sum of the primaries, but in CIE XYZ space the luminance is already somewhat accurately described by the Y primary — which means it can be represented using the Y primary. The chromaticity (x,y) along with luminance Y forms the CIE xyY colour space.
{% end %}

## Gamut

As mentioned, the chromaticity of a colour can be described by the ratio of the intensity of two monochromatic colours. Conversely, two monochromatic light sources can produce colours having a chromaticity that lies on the line joining the corresponding two points in the CIE xy plane:

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie-gamut-line.txt") }}

Adding a third monochromatic light allows for more combinations of ratios of among the primaries — greatly expanding the chromaticty of colours that can be recreated:

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie-gamut-line-ratios.txt") }}

Using more sources of monochromatic light generally results in a bigger chromaticity space that can be physically recreated by the light sources:

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie-gamut-polygon.txt") }}

The primaries define a [convex polygon](https://en.wikipedia.org/wiki/Convex_polygon), which represents the chromaticity of colours that can be physically recreated by the primaries. This range of colours (chromaticities) that the primaries can produce is called its [gamut](https://en.wikipedia.org/wiki/Gamut). Points lying outside the polygon cannot be physically created, since it would require creating light with negative intensity. 

The gamut of the original CIE RGB primaries on the CIE xy chromaticity diagram would then look like this:

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie-gamut-rgb.txt") }}

{% tangent(summary="CIE RGB chromaticity gamut", open=true) %}
It has been stated that the CIE RGB cannot physically reproduce certain colours and this is yet another representation of the same idea. Although in this case, the diagram represents the *chromaticities* that cannot be reproduced, instead of the exact colours.
{% end %}

The gamut of the display devices depends on its primaries. It is economically efficient to use just three primaries — which are not purely monochromatic. Certain colour spaces are designed keeping such gamut constraints in mind, such as the [sRGB](https://en.wikipedia.org/wiki/SRGB) colour space or the [DCI-P3](https://en.wikipedia.org/wiki/DCI-P3) colour space.

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie-gamut-any.txt") }}

{% tangent(summary="Gamut & Colour space", open=true) %}
Gamut refers to the set of colours that can be physically recreated by an output device, while a colour space is simply a mathematical model used to describe colours. Colour spaces may arbitrarily restrict itself to certain values to more accurately represent physical and economic constraints.
{% end %}

## White Point

Back to some physical science — all bodies radiate photons, due to [blackbody radiation](https://en.wikipedia.org/wiki/Black-body_radiation). The spectral power distribution of the radiation is a [function of temperature](https://en.wikipedia.org/wiki/Planck%27s_law#The_law):

{{ loadData(path="/static/media/lab/quantifying-colour/spd-blackbody.txt") }}

{% tangent(summary="Blackbody", open=true) %}
A blackbody is an idealized body that does not reflect any light and only emits blackbody radiation. Most bodies in the universe are not technically not (perfect) blackbodies, but approximating it as such is still useful nonetheless.
{% end %}

The spectral power distribution of the radiation will have a colour associated with it:

{{ loadData(path="/static/media/lab/quantifying-colour/response-curves-colour-box-blackbody.txt") }}

The colours above have a corresponding chromaticity — and when mapped on the CIE xy chromaticity diagram, form the [planckian locus](https://en.wikipedia.org/wiki/Planckian_locus):

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie-planckian-locus.txt") }}

The [colour temperature](https://en.wikipedia.org/wiki/Color_temperature) is another way to describe certain colours and chromaticities — mostly different types of white. It is a common way to do it, as most physical sources of illumination have a chromaticity close to these values. Daylight, for example, has a chromaticity similar to a blackbody at temperatures ranging from 5000K to 6500K, and incandescent bulbs emit light having a colour temperature close to 2700K.

{% tangent(summary="Daylight colour temperature", open=false) %}
Incandescent bulbs have filaments heated to about 2000K to 2700K and thus have colour temperature close to that temperature. But the same is not true for sunlight as its colour temperature depends on the time of day. Due to [rayleigh scattering](https://en.wikipedia.org/wiki/Rayleigh_scattering), shorter wavelengths of sunlight get scattered making it appear redder, while making skies and overcast light appear bluer. During mornings and evenings when the sun is lower in the sky, more light gets scattered causing sunlight to appear even redder (have a lower colour temperature). Daylight is the combination of all direct and indirect sunlight, and thus also depends on the time of day.
{% end %}

Most illuminants have chromaticty values that lie close to the planckian locus, but do not lie exactly on it — as most bodies are not perfect blackbodies. Also, incadescent lights have been phased out by [flourescent lights](https://en.wikipedia.org/wiki/Fluorescent_lamp#Color_temperature) and [LEDs](https://en.wikipedia.org/wiki/Light-emitting_diode#White_LEDs), which do not use thermal radiation to emit light, and also do not lie on the planckian locus:

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie-planckian-locus-white-points.txt") }}

While the chromaticity values of these illuminants do not lie on the planckian locus, they are still close enough to be perceptually similar to be meaningfully attributed to a colour temperature. These can be assigned a [correlated colour temperature](https://en.wikipedia.org/wiki/Correlated_color_temperature) based on the colour temperature it most closely resembles.

Correlated colour temperatures can also be mapped alongside the planckian locus:

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie-planckian-locus-cct.txt") }}

{% tangent(summary="Correlated colour temperature lines", open=true) %}
The lines intersecting the planckian locus represent correlated colour temperatures. Two points on a correlated colour temperture line have the same correlated correlated colour temperature.
{% end %}

Correlated colour temperature can describe non-ideal blackbodies and other sources of white light. But since a single correlated colour temperature can correspond to multiple chromaticity values, it is not a precise way to describe white light.

To represent different types of white light in an umabiguous way, [standard illuminants](https://en.wikipedia.org/wiki/Standard_illuminant) have been defined — theoretical souces of light having a definitive spectral power distribution, and therefore an exact chromaticity value.

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie-planckian-locus-standard-illuminants-spd.txt") }}

Having a standard and precise way to define illumination sources is necessary because of [chromatic adaptation](https://en.wikipedia.org/wiki/Chromatic_adaptation). Human colour perception adjusts for variations in illumination to preserve colours of objects. Two colours might appear white despite having different 'true' colours because of varying lighting conditions.

{{ loadData(path="/static/media/lab/quantifying-colour/different-white-points.txt") }}

{% tangent(summary="Same colours under different lighting", open=true) %}
Same colours might look different under different lighting conditions and vice versa. [The dress](https://en.wikipedia.org/wiki/The_dress) is a popular example. The same colours can be perceived as either blue and black, or white and golden — depending on the perceived lighting.
{% end %}

Specifying a [white point](https://en.wikipedia.org/wiki/White_point) acts as a reference point for a colour space — to adjust for different viewing mediums and environments. Most colour spaces use the chromaticity of standard illuminants to define their white point.

{{ loadData(path="/static/media/lab/quantifying-colour/xy-plane-cie-white-point.txt") }}

{% tangent(summary="White as reference point", open=true) %}
Dragging the white point to [D65](switch#) or [4500K](switch#) shows how the chromaticity gets transformed to take into account the effects of [chromatic adaptation](https://en.wikipedia.org/wiki/Chromatic_adaptation).
{% end %}

## Colour Science

Colours are a very interesting topic, because it involves quantifying something that feels innately qualitative. So far, only certain [additive colour models](https://en.wikipedia.org/wiki/Additive_color) have been discussed. But there are also [other colour models](https://en.wikipedia.org/wiki/Color_mixing), such as the popular [CMYK model](https://en.wikipedia.org/wiki/CMYK_color_model), which is a type of [subtractive colour model](https://en.wikipedia.org/wiki/Subtractive_color).

Most of these topics involve ways to [describe and recreate colours](https://en.wikipedia.org/wiki/Colorimetry). But there is also an entirely different branch of science that deals with the [psychology of colours](https://en.wikipedia.org/wiki/Color_psychology) — why and how certain [colour combinations](https://en.wikipedia.org/wiki/Color_scheme) appear pleasing, or how the [meaning of colours](https://en.wikipedia.org/wiki/Color_symbolism) vary across cultures. Or how colours can [affect other senses](https://en.wikipedia.org/wiki/Color_psychology#Influence_of_color_on_perception).

The subject of colours is vast — spanning scientific domains from quantum physics and electromagnetism to physiology and psychology. This post is a very tiny fraction of what constitutes [colour science](https://en.wikipedia.org/wiki/Color_science).

---

## References

* Jamie Wong: [Color: From Hexcodes to Eyeballs](https://jamie-wong.com/post/color/)
* Bartosz Ciechanowski: [Color Spaces](https://ciechanow.ski/color-spaces/)
* Douglas A. Kerr: [The CIE XYZ and xyY Color Spaces](https://graphics.stanford.edu/courses/cs148-10-summer/docs/2010--kerr--cie_xyz.pdf)

<!--
Assign (switch#) links a class and make them distinct from other links.
maybe show values next to all sliders
-->
